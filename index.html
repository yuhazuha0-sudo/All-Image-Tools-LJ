<!doctype html>
<html lang="hi">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>All Image Tools — Compressor & Converters</title>
  <meta name="description" content="All Image Tools — client-side image toolkit. Compress, convert, image→PDF, resize, rotate and many more tools. Privacy-first — processing in browser." />
  <link rel="canonical" href="https://example.com/" />
  <!-- Open Graph -->
  <meta property="og:title" content="All Image Tools" />
  <meta property="og:description" content="Privacy-first client-side image toolkit. Convert, edit, compress, OCR and more." />
  <meta property="og:image" content="https://example.com/og-image-placeholder.png" />
  <meta name="twitter:card" content="summary_large_image" />

  <!-- PWA manifest -->
  <link rel="manifest" href="manifest.json" />
  <meta name="theme-color" content="#0d6efd" />

  <!-- Preconnect for CDNs -->
  <link rel="preconnect" href="https://cdn.jsdelivr.net" crossorigin>
  <link rel="preconnect" href="https://cdnjs.cloudflare.com" crossorigin>

  <!-- Bootstrap CSS & Icons -->
  <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.2/dist/css/bootstrap.min.css" rel="stylesheet">
  <link href="https://cdn.jsdelivr.net/npm/bootstrap-icons@1.11.3/font/bootstrap-icons.css" rel="stylesheet">

  <!-- Cropper CSS (used if later) -->
  <link href="https://cdnjs.cloudflare.com/ajax/libs/cropperjs/1.5.13/cropper.min.css" rel="stylesheet">

  <style>
    :root { --brand:#0d6efd; --card-radius:.6rem; --muted:#6c757d; }
    body { font-family: Inter, system-ui, -apple-system, "Segoe UI", Roboto, Arial; background:#f6f9ff; padding-bottom:3.5rem; color:#222; }
    .tool-card { border-radius:var(--card-radius); box-shadow:0 6px 18px rgba(13,110,253,0.06); background:#fff; }
    .dropzone { border:2px dashed rgba(13,110,253,0.12); border-radius:.5rem; padding:12px; text-align:center; cursor:pointer; background:linear-gradient(90deg, rgba(13,110,253,0.02), transparent); }
    .preview-img{ max-width:100%; height:auto; display:block; margin:auto; }
    header .site-title { font-weight:700; letter-spacing:0.2px; display:flex; align-items:center; gap:.6rem; justify-content:center; }
    header .site-title .brand-name { font-size:1.35rem; background: linear-gradient(90deg,#0d6efd,#6610f2); -webkit-background-clip:text; color:transparent; }
    .tool-icon { width:22px; height:22px; vertical-align:middle; margin-right:.5rem; color:var(--brand); }
    .tool-header { display:flex; align-items:center; gap:.5rem; }
    footer { text-align:center; color:var(--muted); margin-top:1.5rem; }
    .sr-only{ position:absolute; left:-10000px; top:auto; width:1px; height:1px; overflow:hidden; }
    @media(min-width:992px){ .preview-img { max-height:360px; } }
  </style>

  <!-- JSON-LD structured data -->
  <script type="application/ld+json">
  {
    "@context": "https://schema.org",
    "@type": "SoftwareApplication",
    "name": "All Image Tools",
    "description": "Privacy-first, client-side image toolkit: compress, convert, OCR, edit, and more.",
    "url": "https://example.com/",
    "applicationCategory": "ImageProcessing",
    "operatingSystem": "Web"
  }
  </script>
</head>
<body>
  <main class="container py-4" id="main">
    <header class="text-center mb-4" role="banner">
      <!-- Logo + Styled title -->
      <div class="site-title mb-2" aria-hidden="false">
        <!-- Inline placeholder SVG logo; replace src with your logo URL if available -->
        <svg id="siteLogo" width="44" height="44" viewBox="0 0 48 48" xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false">
          <defs>
            <linearGradient id="g" x1="0" x2="1" y1="0" y2="1">
              <stop offset="0" stop-color="#0d6efd"/><stop offset="1" stop-color="#6610f2"/>
            </linearGradient>
          </defs>
          <rect width="48" height="48" rx="10" fill="url(#g)"/>
          <g transform="translate(8,8)" fill="#fff">
            <path d="M8 0 L16 0 L16 8 L8 8 Z" opacity="0.95"></path>
            <circle cx="12" cy="12" r="7"></circle>
          </g>
        </svg>
        <div>
          <div class="brand-name">All Image Tools</div>
          <div class="text-muted small">Client-first image toolkit — privacy-focused</div>
        </div>
      </div>

      <!-- Small utility buttons -->
      <div class="mb-3">
        <button id="openFilesBtn" class="btn btn-outline-primary btn-sm me-1" title="Open files (Ctrl+O)"><i class="bi bi-folder2-open"></i> Open</button>
        <button id="enableApiBtn" class="btn btn-outline-warning btn-sm me-1" title="Show API options (opt-in)">API Options</button>
        <button id="helpBtn" class="btn btn-outline-secondary btn-sm" title="How to use">Help</button>
      </div>
    </header>

    <!-- File chooser + preview -->
    <section class="card p-3 mb-4 tool-card" aria-labelledby="fileSectionLabel">
      <h2 id="fileSectionLabel" class="h6 visually-hidden">File selection</h2>
      <div class="row g-3 align-items-center">
        <div class="col-lg-5">
          <label class="form-label fw-semibold">Choose images</label>
          <div id="dropzone" class="dropzone" tabindex="0" role="button" aria-label="Drop images here or click to browse">
            <div class="mb-2"><i class="bi bi-cloud-arrow-up" style="font-size:1.3rem;color:var(--brand)"></i></div>
            <div class="text-muted">Drag & drop, or click to browse (PNG/JPG/WebP/GIF)</div>
            <input id="fileInput" type="file" accept="image/*" multiple hidden aria-hidden="true">
          </div>
          <div class="mt-2 text-muted small">Selected: <span id="fileCount" aria-live="polite">0</span> file(s)</div>
        </div>

        <div class="col-lg-7">
          <label class="form-label fw-semibold">Preview</label>
          <div id="previewArea" class="p-2" style="min-height:120px;">
            <div id="previewPlaceholder" class="text-muted">Preview of first selected image will appear here.</div>
            <img id="previewImage" class="preview-img d-none" alt="preview">
          </div>
          <div class="mt-2 d-flex gap-2">
            <button id="clearBtn" class="btn btn-outline-danger btn-sm"><i class="bi bi-x-circle"></i> Clear</button>
            <a id="downloadAllBtn" class="btn btn-outline-success btn-sm d-none"><i class="bi bi-download"></i> Download</a>
          </div>
        </div>
      </div>
    </section>

    <!-- Tools grid -->
    <section class="row g-3" id="toolsGrid" aria-labelledby="toolsHeading">
      <h2 id="toolsHeading" class="sr-only">Tools</h2>

      <!-- Image Compressor -->
      <div class="col-md-6">
        <div class="card p-3 tool-card h-100" role="region" aria-labelledby="compressorTitle">
          <div id="compressorTitle" class="tool-header">
            <i class="bi bi-bezier tool-icon" aria-hidden="true"></i>
            <h5 class="mb-0">Image Compressor</h5>
          </div>
          <p class="text-muted small">Reduce file size (quality 0.1 - 1.0). Client-only by default.</p>
          <label class="form-label">Quality: <span id="qualityLabel">0.8</span></label>
          <input id="qualityRange" type="range" min="0.1" max="1" step="0.05" value="0.8" class="form-range mb-2" aria-label="Compressor quality">
          <div class="d-flex gap-2">
            <button id="compressBtn" class="btn btn-primary"><i class="bi bi-gear-wide-connected"></i> Compress Selected</button>
            <button id="compressAllBtn" class="btn btn-outline-primary">Compress All</button>
          </div>
        </div>
      </div>

      <!-- Image → PDF -->
      <div class="col-md-6">
        <div class="card p-3 tool-card h-100" role="region" aria-labelledby="img2pdfTitle">
          <div id="img2pdfTitle" class="tool-header">
            <i class="bi bi-file-earmark-pdf-fill tool-icon" aria-hidden="true"></i>
            <h5 class="mb-0">Image → PDF</h5>
          </div>
          <p class="text-muted small">Combine images into PDF (multi-page).</p>
          <label class="form-label">Orientation</label>
          <select id="pdfOrientation" class="form-select form-select-sm mb-2" aria-label="Choose PDF orientation"><option value="portrait" selected>Portrait</option><option value="landscape">Landscape</option></select>
          <button id="imgToPdfBtn" class="btn btn-success"><i class="bi bi-file-earmark-pdf"></i> Convert to PDF</button>
        </div>
      </div>

      <!-- JPG → PNG -->
      <div class="col-md-6">
        <div class="card p-3 tool-card h-100" role="region" aria-labelledby="jpg2pngTitle">
          <div id="jpg2pngTitle" class="tool-header">
            <i class="bi bi-filetype-jpg tool-icon" aria-hidden="true"></i>
            <h5 class="mb-0">JPG → PNG</h5>
          </div>
          <p class="text-muted small">Convert JPG/JPEG to PNG (lossless container conversion).</p>
          <button id="jpg2pngBtn" class="btn btn-outline-secondary">Convert Selected</button>
        </div>
      </div>

      <!-- PNG → JPG -->
      <div class="col-md-6">
        <div class="card p-3 tool-card h-100" role="region" aria-labelledby="png2jpgTitle">
          <div id="png2jpgTitle" class="tool-header">
            <i class="bi bi-filetype-png tool-icon" aria-hidden="true"></i>
            <h5 class="mb-0">PNG → JPG</h5>
          </div>
          <p class="text-muted small">Convert PNG to JPG (set output quality).</p>
          <label class="form-label">Output quality: <span id="png2jpgQualityLabel">0.9</span></label>
          <input id="png2jpgQualityRange" type="range" min="0.1" max="1" step="0.05" value="0.9" class="form-range mb-2" aria-label="PNG to JPG quality">
          <button id="png2jpgBtn" class="btn btn-outline-secondary">Convert Selected</button>
        </div>
      </div>

      <!-- Resize & Rotate -->
      <div class="col-md-6">
        <div class="card p-3 tool-card h-100" role="region" aria-labelledby="resizeTitle">
          <div id="resizeTitle" class="tool-header">
            <i class="bi bi-arrows-expand tool-icon" aria-hidden="true"></i>
            <h5 class="mb-0">Resize & Rotate</h5>
          </div>
          <label class="form-label">Width (px)</label>
          <input id="resizeWidth" type="number" class="form-control form-control-sm mb-2" placeholder="e.g. 1200" aria-label="Width">
          <label class="form-label">Height (px)</label>
          <input id="resizeHeight" type="number" class="form-control form-control-sm mb-2" placeholder="e.g. 800" aria-label="Height">
          <div class="mb-2">
            <div class="d-flex gap-2">
              <button data-rotate="-90" class="rotateBtn btn btn-sm btn-outline-secondary" aria-pressed="false">⟲ -90°</button>
              <button data-rotate="90" class="rotateBtn btn btn-sm btn-outline-secondary" aria-pressed="false">⟳ 90°</button>
              <button data-rotate="180" class="rotateBtn btn btn-sm btn-outline-secondary" aria-pressed="false">180°</button>
            </div>
          </div>
          <div class="d-flex gap-2">
            <button id="resizeBtn" class="btn btn-success btn-sm">Apply Resize</button>
            <button id="rotateApplyBtn" class="btn btn-success btn-sm">Apply Rotate</button>
          </div>
        </div>
      </div>

      <!-- (Note) Additional tool cards can be appended here. We preserved your existing tools and added icons and ARIA -->
    </section>

    <footer>
      <small>All processing runs in browser. No uploads. — Debug Build (open console for logs)</small>
    </footer>
  </main>

  <!-- Required libraries (CDN) -->
  <!-- Use recommended versions; heavy libraries (ffmpeg.wasm, face-api) are not loaded by default -->
  <script src="https://cdn.jsdelivr.net/npm/browser-image-compression@2.0.0/dist/browser-image-compression.js"></script>
  <script src="https://cdn.jsdelivr.net/npm/jspdf@2.5.1/dist/jspdf.umd.min.js"></script>
  <script src="https://cdnjs.cloudflare.com/ajax/libs/FileSaver.js/2.0.5/FileSaver.min.js"></script>
  <script src="https://cdn.jsdelivr.net/npm/jszip@3.10.1/dist/jszip.min.js"></script>
  <script src="https://cdn.jsdelivr.net/npm/color-thief-browser@2.0.0/dist/color-thief.umd.js"></script>
  <script src="https://cdn.jsdelivr.net/npm/tesseract.js@4.1.1/dist/tesseract.min.js"></script>
  <script src="https://cdn.jsdelivr.net/npm/piexifjs@1.0.6/piexif.min.js"></script>
  <script src="https://cdnjs.cloudflare.com/ajax/libs/pdf.js/3.9.179/pdf.min.js"></script>
  <script src="https://cdnjs.cloudflare.com/ajax/libs/cropperjs/1.5.13/cropper.min.js"></script>
  <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.2/dist/js/bootstrap.bundle.min.js"></script>

  <!-- Your original JavaScript with small enhancements preserved -->
  <script>
    // Keep your original debug message
    console.log('All Image Tools — enhanced build starting...');

    // DOM refs
    const fileInput = document.getElementById('fileInput');
    const dropzone = document.getElementById('dropzone');
    const fileCount = document.getElementById('fileCount');
    const previewImage = document.getElementById('previewImage');
    const previewPlaceholder = document.getElementById('previewPlaceholder');
    const qualityRange = document.getElementById('qualityRange');
    const qualityLabel = document.getElementById('qualityLabel');
    const compressBtn = document.getElementById('compressBtn');
    const compressAllBtn = document.getElementById('compressAllBtn');
    const imgToPdfBtn = document.getElementById('imgToPdfBtn');
    const jpg2pngBtn = document.getElementById('jpg2pngBtn');
    const png2jpgBtn = document.getElementById('png2jpgBtn');
    const png2jpgQualityRange = document.getElementById('png2jpgQualityRange');
    const png2jpgQualityLabel = document.getElementById('png2jpgQualityLabel');
    const resizeBtn = document.getElementById('resizeBtn');
    const resizeWidth = document.getElementById('resizeWidth');
    const resizeHeight = document.getElementById('resizeHeight');
    const rotateApplyBtn = document.getElementById('rotateApplyBtn');
    const rotateBtns = document.querySelectorAll('.rotateBtn');
    const clearBtn = document.getElementById('clearBtn');
    const downloadAllBtn = document.getElementById('downloadAllBtn');

    // Additional controls
    const openFilesBtn = document.getElementById('openFilesBtn');
    const enableApiBtn = document.getElementById('enableApiBtn');
    const helpBtn = document.getElementById('helpBtn');

    let selectedFiles = [];
    let pendingRotateDegrees = 0;

    function logState(){ console.log('Selected files:', selectedFiles.map(f=>f.name)); }

    function updateFileCount(){
      fileCount.textContent = selectedFiles.length;
      if(selectedFiles.length === 0){
        previewImage.classList.add('d-none');
        previewPlaceholder.classList.remove('d-none');
        downloadAllBtn.classList.add('d-none');
      } else {
        previewPlaceholder.classList.add('d-none');
        previewImage.classList.remove('d-none');
        downloadAllBtn.classList.remove('d-none');
        showPreview(selectedFiles[0]);
      }
      logState();
    }

    function showPreview(file){
      const url = URL.createObjectURL(file);
      previewImage.src = url;
      previewImage.onload = () => URL.revokeObjectURL(url);
      previewImage.alt = file.name;
    }

    // Drag/drop & file select with accessibility
    dropzone.addEventListener('click', () => fileInput.click());
    dropzone.addEventListener('keydown', (e)=> { if(e.key==='Enter' || e.key===' ') fileInput.click(); });
    dropzone.addEventListener('dragover', e => { e.preventDefault(); dropzone.classList.add('border-primary'); });
    dropzone.addEventListener('dragleave', () => dropzone.classList.remove('border-primary'));
    dropzone.addEventListener('drop', e => {
      e.preventDefault();
      dropzone.classList.remove('border-primary');
      const dt = e.dataTransfer;
      if(dt && dt.files) handleFiles(Array.from(dt.files));
    });
    fileInput.addEventListener('change', e => handleFiles(Array.from(e.target.files)));

    function handleFiles(files){
      const imgs = files.filter(f => f.type && f.type.startsWith('image/'));
      if(imgs.length === 0){ alert('Please select image files.'); return; }
      // Prevent duplicates (by name + size)
      for(const f of imgs){
        if(!selectedFiles.some(sf => sf.name === f.name && sf.size === f.size)) selectedFiles.push(f);
      }
      updateFileCount();
    }

    clearBtn.addEventListener('click', () => {
      selectedFiles = [];
      updateFileCount();
    });

    downloadAllBtn.addEventListener('click', () => {
      if(selectedFiles.length === 0) return alert('No files selected.');
      if(selectedFiles.length === 1) saveAs(selectedFiles[0], selectedFiles[0].name);
      else selectedFiles.forEach(f => saveAs(f, f.name));
    });

    qualityRange?.addEventListener('input', () => qualityLabel.textContent = qualityRange.value);
    png2jpgQualityRange?.addEventListener('input', () => png2jpgQualityLabel.textContent = png2jpgQualityRange.value);

    // Helpers
    function fileToDataURL(file){ return new Promise((res,rej)=> { const fr=new FileReader(); fr.onload=()=>res(fr.result); fr.onerror=rej; fr.readAsDataURL(file); }); }
    function createImage(dataUrl){ return new Promise((res,rej)=>{ const img=new Image(); img.onload=()=>res(img); img.onerror=rej; img.src=dataUrl; }); }
    function changeExt(name, newExt){ return name.replace(/\.[^/.]+$/, newExt.startsWith('.') ? newExt : '.'+newExt); }

    // Converters & actions (preserve your original behavior)
    compressBtn.addEventListener('click', async () => {
      try{
        if(selectedFiles.length===0) return alert('Select images first.');
        const file = selectedFiles[0];
        const quality = parseFloat(qualityRange.value || 0.8);
        console.log('Compressing', file.name, 'quality', quality);
        const options = { initialQuality: quality, useWebWorker: true };
        // NOTE: using browser-image-compression v2+ API supports maxSizeMB etc. We keep initialQuality for backwards compat.
        const compressedBlob = await imageCompression(file, options);
        saveAs(compressedBlob, changeExt(file.name,'') + '-compressed.jpg');
      }catch(err){ console.error('compress err',err); alert('Compression failed: '+(err.message || err)); }
    });

    compressAllBtn.addEventListener('click', async () => {
      if(selectedFiles.length===0) return alert('Select images first.');
      const quality = parseFloat(qualityRange.value || 0.8);
      for(const file of selectedFiles){
        try{
          const b = await imageCompression(file, { initialQuality: quality, useWebWorker:true });
          saveAs(b, changeExt(file.name,'') + '-compressed.jpg');
        }catch(e){ console.error('compress all err', e); }
      }
    });

    imgToPdfBtn.addEventListener('click', async () => {
      if(selectedFiles.length===0) return alert('Select images first.');
      const { jsPDF } = window.jspdf;
      const orientation = document.getElementById('pdfOrientation').value || 'portrait';
      const pdf = new jsPDF({ unit:'pt', format:'a4', orientation });
      try{
        for(let i=0;i<selectedFiles.length;i++){
          const file = selectedFiles[i];
          const dataUrl = await fileToDataURL(file);
          const img = await createImage(dataUrl);
          const pageW = pdf.internal.pageSize.getWidth();
          const pageH = pdf.internal.pageSize.getHeight();
          const ratio = Math.min(pageW/img.width, pageH/img.height);
          const imgW = img.width*ratio, imgH = img.height*ratio;
          const x = (pageW - imgW)/2, y = (pageH - imgH)/2;
          pdf.addImage(dataUrl, file.type.includes('png') ? 'PNG' : 'JPEG', x, y, imgW, imgH);
          if(i < selectedFiles.length-1) pdf.addPage();
        }
        pdf.save('images.pdf');
      }catch(err){ console.error('pdf err'
