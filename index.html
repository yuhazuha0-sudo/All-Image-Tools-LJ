<!doctype html>
<html lang="hi">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>All Image Tools — Superfast Tools</title>

  <meta name="description" content="Selected popular image tools: Compressor, Resize, Image → PDF, JPG → PNG. Privacy-first — client-side processing." />
  <meta name="theme-color" content="#0d6efd">

  <link rel="canonical" href="https://yuhazuha0-sudo.github.io/All-Image-Tools/" />
  <link rel="manifest" href="/All-Image-Tools/manifest.json?v=1">

  <link rel="icon" type="image/png" sizes="192x192" href="/All-Image-Tools/icons/icon-192.png">
  <link rel="icon" type="image/png" sizes="512x512" href="/All-Image-Tools/icons/icon-512.png">
  <link rel="shortcut icon" href="/All-Image-Tools/icons/icon-192.png">
  <link rel="apple-touch-icon" sizes="192x192" href="/All-Image-Tools/icons/icon-192.png">
  <link rel="apple-touch-icon" sizes="512x512" href="/All-Image-Tools/icons/icon-512.png">

  <meta property="og:type" content="website" />
  <meta property="og:title" content="All Image Tools — Select Tools" />
  <meta property="og:description" content="Compressor, Resize, Image→PDF, JPG→PNG — all client-side." />
  <meta property="og:url" content="https://yuhazuha0-sudo.github.io/All-Image-Tools/" />
  <meta property="og:image" content="https://yuhazuha0-sudo.github.io/All-Image-Tools/icons/icon-512.png" />

  <link rel="preconnect" href="https://cdn.jsdelivr.net" crossorigin>
  <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.2/dist/css/bootstrap.min.css" rel="stylesheet">
  <link href="https://cdn.jsdelivr.net/npm/bootstrap-icons@1.11.3/font/bootstrap-icons.css" rel="stylesheet">

  <style>
    :root{
      --bg:#f6f9ff; --card:#fff; --text:#222; --muted:#6c757d;
      --brand:#0d6efd;
      --accent: linear-gradient(90deg,#ff6b6b,#ffb86b);
      --card-radius:.8rem;
    }
    body{
      background:var(--bg); color:var(--text); font-family: Inter, system-ui, -apple-system, "Segoe UI", Roboto, Arial;
      padding: 1.5rem 0 3.5rem;
    }
    .tool-card{ border-radius:var(--card-radius); background:var(--card); box-shadow:0 8px 22px rgba(13,110,253,0.06); }
    header { max-width:1100px; margin:0 auto 18px; padding: 10px; }
    /* Header card */
    .header-inner {
      display:flex; align-items:center; gap:14px; justify-content:space-between;
      background:rgba(255,255,255,0.95); padding:12px 16px; border-radius:14px; box-shadow:0 8px 24px rgba(13,110,253,0.06);
    }
    .brand-row{ display:flex; align-items:center; gap:12px; flex:1; }
    .tool-logo { width:82px; height:82px; border-radius:12px; object-fit:contain; box-shadow:0 8px 26px rgba(13,110,253,0.06); flex-shrink:0; }
    .brand-title { font-weight:900; font-size:1.8rem; margin:0; background: linear-gradient(90deg, #0d6efd 0%, #6f42c1 45%, #ff6b6b 100%); -webkit-background-clip:text; color:transparent; }
    .brand-sub { font-size:0.95rem; color:var(--muted); margin-top:2px; font-weight:600; }
    .header-actions { display:flex; gap:8px; align-items:center; }

    /* Quick Upload card (new) */
    .quick-upload { background:#fff; padding:14px; border-radius:12px; box-shadow:0 8px 20px rgba(13,110,253,0.04); margin:0 auto 18px; max-width:1100px; }
    .quick-upload .big-input { border:2px dashed rgba(13,110,253,0.12); border-radius:10px; padding:16px; text-align:center; cursor:pointer; }
    .quick-upload img.preview-thumb { max-height:100px; margin:8px; border-radius:8px; display:inline-block; }

    /* Tools grid */
    .tools-wrap { max-width:1100px; margin:0 auto; }

    /* Card header for tools */
    .tool-header { display:flex; align-items:center; gap:10px; margin-bottom:6px; }
    .tool-header h5 { font-size:1.15rem; margin:0; font-weight:800; }
    .tool-badge { font-size:.85rem; color:var(--muted); margin-left:auto; }

    /* Improved file input inside each tool */
    .tool-file { display:flex; gap:8px; align-items:center; margin-bottom:8px; }
    .tool-file input[type="file"] { display:none; }
    .file-btn { padding:.4rem .7rem; border-radius:.5rem; border:1px dashed rgba(13,110,253,0.12); background:#fafafa; cursor:pointer; display:inline-flex; align-items:center; gap:.5rem; }
    .thumb-preview { max-height:80px; border-radius:8px; display:inline-block; }

    /* Buttons area - keep download link next to action */
    .action-group { display:flex; gap:.6rem; align-items:center; flex-wrap:wrap; }

    /* download link style */
    .download-link { padding:.35rem .6rem; background:#198754; color:#fff; border-radius:.5rem; text-decoration:none; font-weight:600; display:inline-flex; gap:6px; align-items:center; }

    /* small muted text */
    .small-muted{ color:var(--muted); }

    /* tidy spacing inside cards */
    .card .form-label { margin-bottom:.25rem; font-weight:600; color:#444; }
    .card .mb-2 { margin-bottom:.6rem !important; }

    /* remove old fixed heights */
    .card.p-3.tool-card { min-height:0; height:auto; }

    /* responsive */
    @media (max-width:680px){
      .header-inner { flex-direction:column; align-items:center; text-align:center; gap:8px; }
      .brand-row { justify-content:center; }
      .brand-title{ font-size:1.3rem; }
      .tool-logo { width:64px; height:64px; }
    }
  </style>
</head>
<body>
  <main class="container">

    <!-- Header -->
    <header>
      <div class="header-inner">
        <div class="brand-row">
          <img class="tool-logo" alt="All Image Tools" src="/All-Image-Tools/icons/icon-192.png"
               onerror="this.onerror=null;this.src='/All-Image-Tools/icons/icon-512.png?v=2'">
          <div>
            <div class="brand-title">All Image Tools</div>
            <div class="brand-sub">Superfast Tools</div>
          </div>
        </div>

        <div class="header-actions">
          <button id="globalOpenBtn" class="btn btn-outline-primary btn-sm me-1"><i class="bi bi-folder2-open"></i> Open</button>
          <button id="helpBtn" class="btn btn-outline-secondary btn-sm">Help</button>
        </div>
      </div>
    </header>

    <!-- Quick Upload (replaces old dropzone) -->
    <section class="quick-upload mb-3">
      <div class="d-flex align-items-center justify-content-between flex-wrap">
        <div>
          <h5 style="margin:0 0 .35rem 0;">Quick Upload</h5>
          <div class="small-muted">Select images here as a quick global fallback. Files added here can be used by each tool.</div>
        </div>
        <div>
          <input id="quickFileInput" type="file" accept="image/*" multiple style="display:none">
          <div id="quickChooser" class="big-input" role="button" tabindex="0">
            <i class="bi bi-cloud-arrow-up" style="font-size:1.2rem;color:var(--brand)"></i>
            <div>Add images (click) or drag & drop here</div>
          </div>
        </div>
      </div>
      <div id="quickPreview" class="mt-3"></div>
    </section>

    <!-- Tools -->
    <section class="tools-wrap">
      <div class="row g-3">

        <!-- 1) Image Compressor -->
        <div class="col-md-6">
          <div class="card p-3 tool-card" id="card-compressor">
            <div class="tool-header">
              <img src="icons/compressor.png" class="tool-logo" style="width:46px;height:46px;box-shadow:none" onerror="this.style.display='none'">
              <h5>Image Compressor</h5>
              <div class="tool-badge">Reduce size</div>
            </div>
            <p class="small-muted">Adjust quality / max edge. Processing happens in your browser.</p>

            <div class="tool-file">
              <label class="file-btn" for="compFileBtn"><i class="bi bi-image"></i> Choose image</label>
              <input id="compFileBtn" type="file" accept="image/*" class="tool-input" data-tool="compressor">
              <div id="compPreview" class="ms-2"></div>
              <button id="compClear" class="btn btn-sm btn-outline-secondary ms-auto" style="display:none">Clear</button>
            </div>

            <label class="form-label">Quality (0.1 - 1.0) <small id="compQualityLabel">0.8</small></label>
            <input id="compQuality" type="range" min="0.1" max="1" step="0.01" value="0.8" class="form-range mb-2">

            <label class="form-label">Max long-edge (px) — optional</label>
            <input id="compMaxEdge" type="number" class="form-control form-control-sm mb-2" placeholder="e.g. 1600">

            <div class="action-group">
              <button id="compressBtn" class="btn btn-tool"><i class="bi bi-filter-circle"></i> Compress</button>
              <a id="compDownload" class="download-link" style="display:none"><i class="bi bi-download"></i> Download</a>
              <span id="compStatus" class="small-muted align-self-center">Ready</span>
            </div>
          </div>
        </div>

        <!-- 2) Resize -->
        <div class="col-md-6">
          <div class="card p-3 tool-card" id="card-resize">
            <div class="tool-header">
              <img src="icons/resize.png" class="tool-logo" style="width:46px;height:46px;box-shadow:none" onerror="this.style.display='none'">
              <h5>Resize</h5>
              <div class="tool-badge">Change dimensions</div>
            </div>
            <p class="small-muted">Preserve aspect ratio or set width/height.</p>

            <div class="tool-file">
              <label class="file-btn" for="resizeFileBtn"><i class="bi bi-image"></i> Choose image</label>
              <input id="resizeFileBtn" type="file" accept="image/*" class="tool-input" data-tool="resize">
              <div id="resizePreview" class="ms-2"></div>
              <button id="resizeClear" class="btn btn-sm btn-outline-secondary ms-auto" style="display:none">Clear</button>
            </div>

            <div class="row g-2 mb-2">
              <div class="col">
                <label class="form-label">Width (px)</label>
                <input id="resizeW" type="number" class="form-control form-control-sm" placeholder="e.g. 1200">
              </div>
              <div class="col">
                <label class="form-label">Height (px)</label>
                <input id="resizeH" type="number" class="form-control form-control-sm" placeholder="e.g. 800">
              </div>
            </div>

            <div class="form-check form-switch mb-2">
              <input class="form-check-input" type="checkbox" id="keepAspect" checked>
              <label class="form-check-label small-muted" for="keepAspect">Preserve aspect ratio</label>
            </div>

            <div class="action-group">
              <button id="applyResizeBtn" class="btn btn-tool"><i class="bi bi-arrows-angle-contract"></i> Apply</button>
              <a id="resizeDownload" class="download-link" style="display:none"><i class="bi bi-download"></i> Download</a>
              <span id="resizeStatus" class="small-muted align-self-center">Ready</span>
            </div>
          </div>
        </div>

        <!-- 3) Image → PDF (multi-page) -->
        <div class="col-md-6">
          <div class="card p-3 tool-card" id="card-pdf">
            <div class="tool-header">
              <img src="icons/pdf.png" class="tool-logo" style="width:46px;height:46px;box-shadow:none" onerror="this.style.display='none'">
              <h5>Image → PDF</h5>
              <div class="tool-badge">Multiple images</div>
            </div>
            <p class="small-muted">Combine images into one PDF.</p>

            <div class="tool-file">
              <label class="file-btn" for="pdfFileBtn"><i class="bi bi-images"></i> Choose images</label>
              <input id="pdfFileBtn" type="file" accept="image/*" class="tool-input" data-tool="imgpdf" multiple>
              <div id="pdfPreview" class="ms-2"></div>
              <button id="pdfClear" class="btn btn-sm btn-outline-secondary ms-auto" style="display:none">Clear</button>
            </div>

            <label class="form-label">Orientation</label>
            <select id="pdfOrient" class="form-select form-select-sm mb-2"><option value="portrait" selected>Portrait</option><option value="landscape">Landscape</option></select>

            <div class="action-group">
              <button id="imgToPdfBtn" class="btn btn-tool"><i class="bi bi-file-earmark-arrow-down"></i> Create PDF</button>
              <a id="pdfDownload" class="download-link" style="display:none"><i class="bi bi-download"></i> Download</a>
              <span id="pdfStatus" class="small-muted align-self-center">Ready</span>
            </div>
          </div>
        </div>

        <!-- 4) JPG ↔ PNG -->
        <div class="col-md-6">
          <div class="card p-3 tool-card" id="card-convert">
            <div class="tool-header">
              <img src="icons/jpg2png.png" class="tool-logo" style="width:46px;height:46px;box-shadow:none" onerror="this.style.display='none'">
              <h5>JPG ↔ PNG</h5>
              <div class="tool-badge">Convert formats</div>
            </div>
            <p class="small-muted">Convert between JPG and PNG. Set quality for PNG→JPG.</p>

            <div class="tool-file">
              <label class="file-btn" for="convFileBtn"><i class="bi bi-image"></i> Choose image</label>
              <input id="convFileBtn" type="file" accept="image/*" class="tool-input" data-tool="jpgpng">
              <div id="convPreview" class="ms-2"></div>
              <button id="convClear" class="btn btn-sm btn-outline-secondary ms-auto" style="display:none">Clear</button>
            </div>

            <label class="form-label">PNG → JPG Quality: <span id="convQualityLabel">0.9</span></label>
            <input id="convQuality" type="range" min="0.1" max="1" step="0.01" value="0.9" class="form-range mb-2">

            <div class="action-group">
              <button id="jpgToPngBtn" class="btn btn-tool">JPG → PNG</button>
              <button id="pngToJpgBtn" class="btn btn-tool">PNG → JPG</button>
              <a id="convDownload" class="download-link" style="display:none"><i class="bi bi-download"></i> Download</a>
              <span id="convStatus" class="small-muted align-self-center">Ready</span>
            </div>
          </div>
        </div>

      </div>
    </section>

    <footer class="mt-4 mb-5 text-center" style="max-width:1100px;margin:18px auto 0;">
      <div class="small-muted">All processing occurs in your browser by default. API options are opt-in only.</div>
    </footer>
  </main>

  <!-- Libraries -->
  <script src="https://cdn.jsdelivr.net/npm/browser-image-compression@1.0.18/dist/browser-image-compression.js" defer></script>
  <script src="https://cdn.jsdelivr.net/npm/jspdf@2.5.1/dist/jspdf.umd.min.js" defer></script>
  <script src="https://cdnjs.cloudflare.com/ajax/libs/FileSaver.js/2.0.5/FileSaver.min.js" defer></script>

  <script>
  (function(){
    const $ = (s, ctx=document) => ctx.querySelector(s);
    const $$ = (s, ctx=document) => Array.from(ctx.querySelectorAll(s));

    // Global quick upload
    const quickChooser = $('#quickChooser'), quickFileInput = $('#quickFileInput'), quickPreview = $('#quickPreview');
    let globalFiles = [];

    quickChooser.addEventListener('click', ()=> quickFileInput.click());
    quickChooser.addEventListener('dragover', e=>{ e.preventDefault(); quickChooser.style.borderColor='var(--brand)'; });
    quickChooser.addEventListener('dragleave', ()=>{ quickChooser.style.borderColor=''; });
    quickChooser.addEventListener('drop', e=>{ e.preventDefault(); quickChooser.style.borderColor=''; handleQuickFiles(Array.from(e.dataTransfer.files)); });
    quickFileInput.addEventListener('change', e=> handleQuickFiles(Array.from(e.target.files)));

    function handleQuickFiles(files){
      const imgs = files.filter(f=> f.type && f.type.startsWith('image/'));
      if(!imgs.length){ alert('Please select images'); return; }
      imgs.forEach(f=> {
        if(!globalFiles.some(g=> g.name===f.name && g.size===f.size)) globalFiles.push(f);
      });
      renderQuickPreview();
    }
    function renderQuickPreview(){
      quickPreview.innerHTML = '';
      globalFiles.slice(0,12).forEach(f=>{
        const img = document.createElement('img');
        img.src = URL.createObjectURL(f); img.onload = ()=> URL.revokeObjectURL(img.src);
        img.className = 'preview-thumb';
        quickPreview.appendChild(img);
      });
    }

    // Per-tool file handling & previews (improved inputs)
    const perTool = {};
    $$('.tool-input').forEach(inp => {
      const tool = inp.dataset.tool;
      const clearBtn = inp.id === 'compFileBtn' ? $('#compClear') :
                       inp.id === 'resizeFileBtn' ? $('#resizeClear') :
                       inp.id === 'pdfFileBtn' ? $('#pdfClear') :
                       inp.id === 'convFileBtn' ? $('#convClear') : null;
      const preview = inp.id === 'compFileBtn' ? $('#compPreview') :
                      inp.id === 'resizeFileBtn' ? $('#resizePreview') :
                      inp.id === 'pdfFileBtn' ? $('#pdfPreview') :
                      inp.id === 'convFileBtn' ? $('#convPreview') : null;

      // clicking the styled label will open the hidden input due to for="" mapping; handle change:
      inp.addEventListener('change', e=>{
        const files = inp.files ? Array.from(inp.files) : [];
        perTool[tool] = files.length === 1 ? files[0] : files;
        // render preview
        if(!preview) return;
        preview.innerHTML = '';
        const filesArr = Array.isArray(perTool[tool]) ? perTool[tool] : (perTool[tool] ? [perTool[tool]] : []);
        if(!filesArr.length){
          preview.innerHTML = '<div class="small-muted">No file selected</div>';
          clearBtn && (clearBtn.style.display='none');
        } else {
          filesArr.slice(0,3).forEach(f=>{
            if(!f.type.startsWith('image/')) return;
            const img = document.createElement('img');
            img.src = URL.createObjectURL(f); img.onload = ()=> URL.revokeObjectURL(img.src);
            img.className = 'thumb-preview';
            preview.appendChild(img);
          });
          clearBtn && (clearBtn.style.display='inline-block');
        }
      });

      // clear button
      if(clearBtn){
        clearBtn.addEventListener('click', ()=>{
          inp.value = ''; perTool[tool] = null;
          if($('#' + (inp.id==='compFileBtn' ? 'compPreview' : inp.id==='resizeFileBtn' ? 'resizePreview' : inp.id==='pdfFileBtn' ? 'pdfPreview' : 'convPreview'))) {
            const p = inp.id==='compFileBtn' ? $('#compPreview') : inp.id==='resizeFileBtn' ? $('#resizePreview') : inp.id==='pdfFileBtn' ? $('#pdfPreview') : $('#convPreview');
            p.innerHTML = '<div class="small-muted">No file selected</div>';
          }
          clearBtn.style.display='none';
        });
      }
    });

    // Helper: fallback file for a tool -> prefer perTool, else first global file
    function fileFor(tool){
      if(perTool[tool]) return perTool[tool];
      return globalFiles.length ? globalFiles[0] : null;
    }

    // Helper to create download link from blob
    function createDownloadLink(aEl, blob, filename){
      const url = URL.createObjectURL(blob);
      aEl.href = url;
      aEl.download = filename;
      aEl.style.display = 'inline-flex';
      // revoke after some time when user likely downloaded
      setTimeout(()=> URL.revokeObjectURL(url), 30000);
    }

    // Save helper fallback (not used for primary flow)
    function saveBlob(blob, filename){
      try{
        if(window.saveAs) { window.saveAs(blob, filename); return; }
        const a = document.createElement('a');
        a.href = URL.createObjectURL(blob);
        a.download = filename; document.body.appendChild(a); a.click(); a.remove();
        setTimeout(()=> URL.revokeObjectURL(a.href), 1500);
      }catch(e){ console.error('save failed', e); alert('Save failed'); }
    }

    // ---------- COMPRESSOR ----------
    const compQuality = $('#compQuality'), compQualityLabel = $('#compQualityLabel');
    compQuality && compQuality.addEventListener('input', ()=> compQualityLabel.textContent = compQuality.value);

    $('#compressBtn').addEventListener('click', async ()=>{
      const f = fileFor('compressor');
      if(!f) return alert('Select an image (compressor).');
      const maxEdge = parseInt($('#compMaxEdge').value) || undefined;
      const startQuality = parseFloat(compQuality.value || 0.8);
      $('#compStatus').textContent = 'Compressing...';
      try{
        const blob = await imageCompression(f, { initialQuality: startQuality, useWebWorker:true, maxWidthOrHeight: maxEdge });
        const filename = (f.name.replace(/\.[^/.]+$/, '')) + '-compressed.jpg';
        createDownloadLink($('#compDownload'), blob, filename);
        $('#compStatus').textContent = 'Done';
      }catch(err){
        console.error(err); alert('Compression failed: '+(err.message||err));
        $('#compStatus').textContent = 'Error';
      }
    });

    // ---------- RESIZE ----------
    $('#applyResizeBtn').addEventListener('click', async ()=>{
      const f = fileFor('resize');
      if(!f) return alert('Select image for resize.');
      const w = parseInt($('#resizeW').value) || null;
      const h = parseInt($('#resizeH').value) || null;
      const keep = $('#keepAspect').checked;
      // no rotate UI — rot = 0
      const rot = 0;
      if(!w && !h && rot===0) return alert('Set width or height.');
      $('#resizeStatus').textContent = 'Processing...';
      try{
        const dataUrl = await new Promise((res, rej)=>{ const fr=new FileReader(); fr.onload=()=>res(fr.result); fr.onerror=rej; fr.readAsDataURL(f); });
        const img = await new Promise((res, rej)=> { const i=new Image(); i.onload=()=>res(i); i.onerror=rej; i.src=dataUrl; });

        let newW = img.width, newH = img.height;
        if(w && h){ newW = w; newH = h; }
        else if(w){ newW = w; newH = keep ? Math.round(img.height*(w/img.width)) : img.height; }
        else if(h){ newH = h; newW = keep ? Math.round(img.width*(h/img.height)) : img.width; }

        // canvas
        const canvas = document.createElement('canvas');
        canvas.width = newW; canvas.height = newH;
        const ctx = canvas.getContext('2d');
        ctx.drawImage(img, 0, 0, newW, newH);

        canvas.toBlob(blob=>{
          const filename = (f.name.replace(/\.[^/.]+$/, '')) + `-resized-${newW}x${newH}.jpg`;
          createDownloadLink($('#resizeDownload'), blob, filename);
          $('#resizeStatus').textContent = 'Done';
        }, 'image/jpeg', 0.92);
      }catch(e){ console.error(e); alert('Resize failed'); $('#resizeStatus').textContent='Error'; }
    });

    // ---------- IMAGE -> PDF ----------
    $('#imgToPdfBtn').addEventListener('click', async ()=>{
      const files = perTool['imgpdf'] ? (Array.isArray(perTool['imgpdf']) ? perTool['imgpdf'] : [perTool['imgpdf']]) : globalFiles;
      if(!files || files.length===0) return alert('Select images for PDF.');
      $('#pdfStatus').textContent = 'Creating PDF...';
      try{
        const { jsPDF } = window.jspdf;
        const orient = $('#pdfOrient').value || 'portrait';
        const pdf = new jsPDF({ unit:'pt', format:'a4', orientation:orient });
        for(let i=0;i<files.length;i++){
          const f = files[i];
          const dataUrl = await new Promise((res, rej)=>{ const fr=new FileReader(); fr.onload=()=>res(fr.result); fr.onerror=rej; fr.readAsDataURL(f); });
          const img = await new Promise((res, rej)=> { const ii=new Image(); ii.onload=()=>res(ii); ii.onerror=rej; ii.src=dataUrl; });
          const pageW = pdf.internal.pageSize.getWidth(), pageH = pdf.internal.pageSize.getHeight();
          const ratio = Math.min(pageW/img.width, pageH/img.height);
          const imgW = img.width*ratio, imgH = img.height*ratio;
          pdf.addImage(dataUrl, f.type.includes('png') ? 'PNG' : 'JPEG', (pageW-imgW)/2, (pageH-imgH)/2, imgW, imgH);
          if(i < files.length-1) pdf.addPage();
        }
        // output as blob and create download link
        const blob = pdf.output('blob');
        createDownloadLink($('#pdfDownload'), blob, 'images.pdf');
        $('#pdfStatus').textContent = 'Done';
      }catch(e){ console.error(e); alert('PDF creation failed'); $('#pdfStatus').textContent='Error'; }
    });

    // ---------- JPG -> PNG ----------
    $('#jpgToPngBtn').addEventListener('click', async ()=>{
      const f = fileFor('jpgpng');
      if(!f) return alert('Select image (JPG → PNG).');
      $('#convStatus').textContent = 'Converting...';
      try{
        const dataUrl = await new Promise((res, rej)=>{ const fr=new FileReader(); fr.onload=()=>res(fr.result); fr.onerror=rej; fr.readAsDataURL(f); });
        const img = await new Promise((res, rej)=> { const ii=new Image(); ii.onload=()=>res(ii); ii.onerror=rej; ii.src=dataUrl; });
        const canvas = document.createElement('canvas'); canvas.width = img.width; canvas.height = img.height;
        canvas.getContext('2d').drawImage(img,0,0);
        canvas.toBlob(blob=> {
          createDownloadLink($('#convDownload'), blob, (f.name.replace(/\.[^/.]+$/, '')) + '.png');
          $('#convStatus').textContent = 'Done';
        }, 'image/png');
      }catch(e){ console.error(e); alert('Convert failed'); $('#convStatus').textContent='Error'; }
    });

    // ---------- PNG -> JPG ----------
    $('#pngToJpgBtn').addEventListener('click', async ()=>{
      const f = fileFor('jpgpng');
      if(!f) return alert('Select image (PNG → JPG).');
      $('#convStatus').textContent = 'Converting...';
      try{
        const q = parseFloat($('#convQuality').value || 0.9);
        const dataUrl = await new Promise((res, rej)=>{ const fr=new FileReader(); fr.onload=()=>res(fr.result); fr.onerror=rej; fr.readAsDataURL(f); });
        const img = await new Promise((res, rej)=> { const ii=new Image(); ii.onload=()=>res(ii); ii.onerror=rej; ii.src=dataUrl; });
        const canvas = document.createElement('canvas'); canvas.width = img.width; canvas.height = img.height;
        const ctx = canvas.getContext('2d'); ctx.fillStyle = '#fff'; ctx.fillRect(0,0,canvas.width,canvas.height);
        ctx.drawImage(img,0,0);
        canvas.toBlob(blob => {
          createDownloadLink($('#convDownload'), blob, (f.name.replace(/\.[^/.]+$/, '')) + '.jpg');
          $('#convStatus').textContent = 'Done';
        }, 'image/jpeg', q);
      }catch(e){ console.error(e); alert('Convert failed'); $('#convStatus').textContent='Error'; }
    });

    // Keyboard shortcut to open quick uploader
    document.addEventListener('keydown', (e)=>{
      if((e.ctrlKey || e.metaKey) && e.key.toLowerCase() === 'o'){ e.preventDefault(); quickFileInput.click(); }
    });

    // Initialize previews text
    ['compPreview','resizePreview','pdfPreview','convPreview'].forEach(id => {
      const el = document.getElementById(id);
      if(el) el.innerHTML = '<div class="small-muted">No file selected</div>';
    });

  })();
  </script>

  <script>
  // small title-typing effect (optional)
  (function(){
    const finalTitle = "All Image Tools — Superfast Tools";
    let idx = 0;
    function type(){ if(idx<=finalTitle.length){ document.title = finalTitle.substring(0, idx); idx++; setTimeout(type, 50); } }
    window.addEventListener('load', ()=>{ document.title=''; setTimeout(type, 200); });
  })();
  </script>
</body>
</html>
  <!-- Twitter Card -->
  <meta name="twitter:card" content="summary_large_image" />
  <meta name="twitter:title" content="All Image Tools — Select Tools" />
  <meta name="twitter:description" content="Compressor, Resize, Image→PDF, JPG→PNG — all client-side." />
  <meta name="twitter:image" content="https://yuhazuha0-sudo.github.io/All-Image-Tools/icons/icon-512.png" />

  <!-- Preconnect & Bootstrap (keep as before) -->
  <link rel="preconnect" href="https://cdn.jsdelivr.net" crossorigin>
  <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.2/dist/css/bootstrap.min.css" rel="stylesheet">
  <link href="https://cdn.jsdelivr.net/npm/bootstrap-icons@1.11.3/font/bootstrap-icons.css" rel="stylesheet">

  <!-- Inline styles (unchanged) -->
  <style>
    :root{
      --bg:#f6f9ff; --card:#fff; --text:#222; --muted:#6c757d;
      --brand:#0d6efd;
      --accent: linear-gradient(90deg,#ff6b6b,#ffb86b);
      --card-radius:.6rem;
    }
    body{
      background:var(--bg); color:var(--text); font-family: Inter, system-ui, -apple-system, "Segoe UI", Roboto, Arial;
      padding: 1.5rem 0 3.5rem;
    }
    .tool-card{ border-radius:var(--card-radius); background:var(--card); box-shadow:0 6px 18px rgba(13,110,253,0.06); }
   /* ---------- Header card, alignment, shadow & blur ---------- */
.header-card {
  background: rgba(255,255,255,0.80);                 /* light card */
  backdrop-filter: blur(6px) saturate(110%);          /* subtle blur */
  -webkit-backdrop-filter: blur(6px) saturate(110%);
  border-radius: 14px;
  box-shadow: 0 10px 30px rgba(13,110,253,0.08);
  padding: 14px 18px;
  margin: 0 auto 18px;
  max-width: 1100px;
  border: 1px solid rgba(13,110,253,0.04);
}

/* Layout inside card */
.header-row {
  display:flex;
  align-items:center;         /* vertical center */
  gap: 12px;
  justify-content: space-between;
}

/* Left group (logo + title) */
.header-left {
  display:flex;
  align-items:center;
  gap: 12px;
}

/* Logo (bigger + crisp) */
.tool-logo{
  width:70px;    /* new default — change if you want */
  height:70px;
  object-fit:contain;
  border-radius:12px;
  display:block;
  flex-shrink:0;
  box-shadow: 0 6px 20px rgba(13,110,253,0.08);
}

/* Brand title — responsive & clamped */
header .brand{
  font-weight:800;
  font-size: clamp(1.4rem, 3.6vw, 2.4rem); /* responsive: min 1.4rem, preferred via vw, max 2.4rem */
  line-height:1;
  margin:0;
  letter-spacing: -0.5px;
  /* smoother gradient */
  background: linear-gradient(90deg, #0d6efd 0%, #6f42c1 45%, #ff6b6b 100%);
  -webkit-background-clip: text;
  background-clip: text;
  color: transparent;
  text-wrap: balance;
}

/* Tagline under the brand */
.header-tagline {
  font-size: 0.98rem;
  color: var(--muted, #6c757d);
  margin-top:4px;
  font-weight:500;
}

/* Right group (controls/buttons) */
.header-right {
  display:flex;
  gap:8px;
  align-items:center;
}

/* Small responsive tweaks */
@media (max-width:680px){
  .header-row { flex-direction:column; align-items:center; gap:10px; }
  .header-right { order:3; width:100%; justify-content:center; }
  .header-left { justify-content:center; text-align:center; }
  .tool-logo { width:56px; height:56px; }
  header .brand { font-size: 1.5rem; }
  .header-card { padding:12px; margin-bottom:12px; }
}

/* Large screens: slightly larger logo/title */
@media (min-width:1200px){
  .tool-logo { width:86px; height:86px; }
  header .brand { font-size: clamp(1.6rem, 2.6vw, 2.8rem); }
}

/* optional: subtle hover lift for the header card */
.header-card:hover {
  transform: translateY(-3px);
  transition: transform .18s ease;
    }
    .btn-tool{ background:var(--accent); color:#fff; border:none; box-shadow:0 6px 18px rgba(255,107,107,0.12); }
    .small-muted{ color:var(--muted); }
    .tool-local-preview img{ max-height:140px; display:block; margin:auto; }
    .dropzone{ border:2px dashed rgba(13,110,253,0.12); padding:12px; text-align:center; border-radius:8px; cursor:pointer; background:linear-gradient(90deg, rgba(13,110,253,0.02), transparent); }
    footer{ color:var(--muted); text-align:center; margin-top:1.5rem; }
    .kbd{ font-size:.8rem; padding:.15rem .35rem; border-radius:.3rem; background:#f1f1f1; border:1px solid #e0e0e0; }
  </style>
</head>
<body>
  <main class="container">
    <header class="text-center mb-4">
      <div class="d-flex align-items-center justify-content-center gap-3 mb-2">
     <img
  class="tool-logo"
  alt="All Image Tools"
  src="/All-Image-Tools/icons/icon-192.png"
  srcset="/All-Image-Tools/icons/icon-192.png 192w, /All-Image-Tools/icons/icon-512.png 512w"
  sizes="55px"
  onerror="this.onerror=null;this.src='/All-Image-Tools/icons/icon-512.png?v=2';"
  loading="eager"
  style="object-fit:contain;border-radius:10px;"
>
        <div>
          <div class="brand">All Image Tools</div>
          <div class="small-muted">Selected popular tools — client-side. No forced uploads.</div>
        </div>
      </div>
      <div>
        <button id="globalOpenBtn" class="btn btn-outline-primary btn-sm me-1"><i class="bi bi-folder2-open"></i> Open (Ctrl+O)</button>
        <button id="helpBtn" class="btn btn-outline-secondary btn-sm">Help</button>
      </div>
    </header>

    <!-- Global fallback chooser (optional) -->
    <section class="mb-4">
      <div class="row g-3">
        <div class="col-lg-6">
          <div class="dropzone" id="globalDropzone" tabindex="0" role="button" aria-label="Drop or click to add images">
            <div><i class="bi bi-cloud-arrow-up" style="font-size:1.2rem;color:var(--brand)"></i></div>
            <div class="small-muted">Drag & drop or click to select files (global fallback)</div>
            <input id="globalFileInput" type="file" accept="image/*" multiple hidden>
          </div>
        </div>
        <div class="col-lg-6">
          <div>
            <span class="small-muted">Selected (global):</span>
            <span id="globalCount">0</span> files — <span class="kbd">Ctrl+O</span>
          </div>
          <div id="globalPreview" class="mt-2"></div>
        </div>
      </div>
    </section>

    <!-- Tools grid -->
    <section class="row g-3">

      <!-- 1) Image Compressor -->
      <div class="col-md-6">
        <div class="card p-3 tool-card h-100" id="card-compressor">
          <div class="d-flex align-items-center mb-2">
            <img src="icons/compressor.png" class="tool-logo" onerror="this.style.display='none'">
            <i class="bi bi-gear tool-icon me-2"></i>
            <h5 class="mb-0">Image Compressor</h5>
          </div>
          <p class="small-muted">Reduce file size. Options: target KB, percentage reduction, quality slider, max edge resize. Batch supported.</p>

          <!-- per-tool input -->
          <label class="form-label small-muted">Input image (per-tool)</label>
          <input type="file" accept="image/*" class="form-control form-control-sm mb-2 tool-input" data-tool="compressor">
          <div class="tool-local-preview mb-2" data-preview="compressor"></div>

          <!-- Options -->
          <label class="form-label">Target size (KB) — leave empty if not needed</label>
          <input id="compTargetKb" type="number" class="form-control form-control-sm mb-2" placeholder="e.g. 150">

          <label class="form-label">Target reduction (%)</label>
          <input id="compTargetPerc" type="number" class="form-control form-control-sm mb-2" placeholder="e.g. 60">

          <label class="form-label">Quality (0.1 - 1.0) <small id="compQualityLabel">0.8</small></label>
          <input id="compQuality" type="range" min="0.1" max="1" step="0.01" value="0.8" class="form-range mb-2">

          <label class="form-label">Max long-edge (px) — optional</label>
          <input id="compMaxEdge" type="number" class="form-control form-control-sm mb-2" placeholder="e.g. 1600">

          <div class="d-flex gap-2">
            <button id="compressBtn" class="btn btn-tool"><i class="bi bi-filter-circle"></i> Compress</button>
            <button id="compressBatchBtn" class="btn btn-outline-primary">Compress Batch</button>
            <a id="compStatus" class="small-muted align-self-center">Ready</a>
          </div>
        </div>
      </div>

      <!-- 2) Resize & Rotate -->
      <div class="col-md-6">
        <div class="card p-3 tool-card h-100" id="card-resize">
          <div class="d-flex align-items-center mb-2">
            <img src="icons/resize.png" class="tool-logo" onerror="this.style.display='none'">
            <i class="bi bi-arrows-fullscreen tool-icon me-2"></i>
            <h5 class="mb-0">Resize & Rotate</h5>
          </div>
          <p class="small-muted">Resize with aspect lock, rotate presets, and arbitrary rotation.</p>

          <label class="form-label small-muted">Input image</label>
          <input type="file" accept="image/*" class="form-control form-control-sm mb-2 tool-input" data-tool="resize">
          <div class="tool-local-preview mb-2" data-preview="resize"></div>

          <div class="row g-2 mb-2">
            <div class="col">
              <label class="form-label">Width (px)</label>
              <input id="resizeW" type="number" class="form-control form-control-sm" placeholder="e.g. 1200">
            </div>
            <div class="col">
              <label class="form-label">Height (px)</label>
              <input id="resizeH" type="number" class="form-control form-control-sm" placeholder="e.g. 800">
            </div>
          </div>

          <div class="form-check form-switch mb-2">
            <input class="form-check-input" type="checkbox" id="keepAspect" checked>
            <label class="form-check-label small-muted" for="keepAspect">Preserve aspect ratio</label>
          </div>

          <label class="form-label">Rotate degrees: <span id="rotLabel">0</span>°</label>
        <!--  <input id="rotRange" type="range" min="-180" max="180" value="0" class="form-range mb-2">-->

          <div class="d-flex gap-2">
            <button id="applyResizeBtn" class="btn btn-tool"><i class="bi bi-arrows-angle-contract"></i> Apply</button>
          <!--  <button data-rotate="-90" class="rotatePreset btn btn-outline-secondary">⟲ -90°</button>
            <button data-rotate="90" class="rotatePreset btn btn-outline-secondary">⟳ 90°</button>
            <button data-rotate="180" class="rotatePreset btn btn-outline-secondary">180°</button>
          </div>-->
        </div>
      </div>

      <!-- 3) Image → PDF (multi-page) -->
      <div class="col-md-6">
        <div class="card p-3 tool-card h-100" id="card-pdf">
          <div class="d-flex align-items-center mb-2">
            <img src="icons/pdf.png" class="tool-logo" onerror="this.style.display='none'">
            <i class="bi bi-file-earmark-pdf tool-icon me-2"></i>
            <h5 class="mb-0">Image → PDF</h5>
          </div>
          <p class="small-muted">Combine images (multi-page). Upload multiple images for PDF.</p>

          <label class="form-label small-muted">Input images (multi)</label>
          <input type="file" accept="image/*" class="form-control form-control-sm mb-2 tool-input" data-tool="imgpdf" multiple>
          <div class="tool-local-preview mb-2" data-preview="imgpdf"></div>

          <label class="form-label">Orientation</label>
          <select id="pdfOrient" class="form-select form-select-sm mb-2"><option value="portrait" selected>Portrait</option><option value="landscape">Landscape</option></select>

          <div class="d-flex gap-2">
            <button id="imgToPdfBtn" class="btn btn-tool"><i class="bi bi-file-earmark-arrow-down"></i> Create PDF</button>
            <a id="pdfStatus" class="small-muted align-self-center">Ready</a>
          </div>
        </div>
      </div>

      <!-- 4) JPG → PNG (and PNG → JPG quality) -->
      <div class="col-md-6">
        <div class="card p-3 tool-card h-100" id="card-convert">
          <div class="d-flex align-items-center mb-2">
            <img src="icons/jpg2png.png" class="tool-logo" onerror="this.style.display='none'">
            <i class="bi bi-filetype-jpg tool-icon me-2"></i>
            <h5 class="mb-0">JPG ↔ PNG</h5>
          </div>
          <p class="small-muted">Convert JPG → PNG and PNG → JPG (adjust quality).</p>

          <label class="form-label small-muted">Input image</label>
          <input type="file" accept="image/*" class="form-control form-control-sm mb-2 tool-input" data-tool="jpgpng">
          <div class="tool-local-preview mb-2" data-preview="jpgpng"></div>

          <label class="form-label">PNG → JPG Quality: <span id="convQualityLabel">0.9</span></label>
          <input id="convQuality" type="range" min="0.1" max="1" step="0.01" value="0.9" class="form-range mb-2">

          <div class="d-flex gap-2">
            <button id="jpgToPngBtn" class="btn btn-tool">JPG → PNG</button>
            <button id="pngToJpgBtn" class="btn btn-tool">PNG → JPG</button>
          </div>
        </div>
      </div>

    </section>

    <footer class="mt-4 mb-5">
      <div class="small-muted">All processing occurs in your browser by default. API options are opt-in only.</div>
    </footer>
  </main>

  <!-- Libraries -->
  <script src="https://cdn.jsdelivr.net/npm/browser-image-compression@1.0.18/dist/browser-image-compression.js" defer></script>
  <script src="https://cdn.jsdelivr.net/npm/jspdf@2.5.1/dist/jspdf.umd.min.js" defer></script>
  <script src="https://cdnjs.cloudflare.com/ajax/libs/FileSaver.js/2.0.5/FileSaver.min.js" defer></script>

  <!-- Main JS -->
  <script>
    (function(){
      // Basic DOM helpers
      const $ = (s, ctx=document) => ctx.querySelector(s);
      const $$ = (s, ctx=document) => Array.from(ctx.querySelectorAll(s));

      // Header logo fallback to uploaded local path if repo icon 404s
      const siteLogo = document.getElementById('siteLogo');
      if(siteLogo){
        siteLogo.addEventListener('error', function(){
          const fallback = this.dataset.localUrl;
          if(fallback && !this.dataset.fallbackUsed){
            this.dataset.fallbackUsed = '1';
            this.src = fallback;
          }
        });
      }

      // Per-tool files map
      const perTool = {}; // toolId -> File or File[]

      // Global files fallback
      let globalFiles = [];

      // Elements
      const globalFileInput = $('#globalFileInput');
      const globalDropzone = $('#globalDropzone');
      const globalCount = $('#globalCount');
      const globalPreview = $('#globalPreview');

      // Attach global open button
      $('#globalOpenBtn').addEventListener('click', ()=> globalFileInput.click());

      // Global handlers
      globalDropzone.addEventListener('click', ()=> globalFileInput.click());
      globalDropzone.addEventListener('dragover', e=>{ e.preventDefault(); globalDropzone.classList.add('border-primary'); });
      globalDropzone.addEventListener('dragleave', ()=> globalDropzone.classList.remove('border-primary'));
      globalDropzone.addEventListener('drop', e=>{ e.preventDefault(); globalDropzone.classList.remove('border-primary'); handleGlobalFiles(Array.from(e.dataTransfer.files)); });

      globalFileInput.addEventListener('change', e=> handleGlobalFiles(Array.from(e.target.files)));

      function handleGlobalFiles(files){
        const imgs = files.filter(f=> f.type && f.type.startsWith('image/'));
        if(!imgs.length) { alert('Please select image files'); return; }
        imgs.forEach(f=> {
          if(!globalFiles.some(g=> g.name===f.name && g.size===f.size)) globalFiles.push(f);
        });
        renderGlobalPreview();
      }
      function renderGlobalPreview(){
        globalCount.textContent = globalFiles.length;
        globalPreview.innerHTML = '';
        globalFiles.slice(0,6).forEach(f=>{
          const img = document.createElement('img');
          img.src = URL.createObjectURL(f); img.onload = ()=> URL.revokeObjectURL(img.src);
          img.style.maxHeight='80px'; img.className='me-2 rounded';
          globalPreview.appendChild(img);
        });
      }

      // Per-tool input delegation
      document.addEventListener('change', (e)=>{
        if(!e.target.classList.contains('tool-input')) return;
        const tool = e.target.dataset.tool;
        if(!tool) return;
        const files = e.target.files ? Array.from(e.target.files) : [];
        perTool[tool] = files.length === 1 ? files[0] : files;
        renderToolPreview(tool);
      });

      function renderToolPreview(tool){
        const container = document.querySelector(`[data-preview="${tool}"]`);
        if(!container) return;
        container.innerHTML = '';
        const files = perTool[tool] ? (Array.isArray(perTool[tool]) ? perTool[tool] : [perTool[tool]]) : [];
        if(!files.length){
          container.innerHTML = '<div class="small-muted">No file selected</div>'; return;
        }
        files.forEach(f=>{
          if(!f.type.startsWith('image/')) return;
          const img = document.createElement('img'); img.className='rounded mb-1';
          img.style.maxHeight='120px';
          const url = URL.createObjectURL(f);
          img.src = url; img.onload = ()=> URL.revokeObjectURL(url);
          container.appendChild(img);
        });
      }

      // Helper: prefer per-tool file, else global first
      function fileFor(tool){
        if(perTool[tool]) return perTool[tool];
        return globalFiles.length ? globalFiles[0] : null;
      }

      // Helpers: file->dataURL, createImage
      function fileToDataURL(file){ return new Promise((res, rej)=> { const fr=new FileReader(); fr.onload=()=>res(fr.result); fr.onerror=rej; fr.readAsDataURL(file); }); }
      function createImage(dataUrl){ return new Promise((res, rej)=> { const img=new Image(); img.onload = ()=> res(img); img.onerror = rej; img.src = dataUrl; }); }
      function changeName(file, suffix){ return (file.name.replace(/\.[^/.]+$/, '')) + suffix; }

      // -------- COMPRESSOR logic (advanced)
      const compQuality = $('#compQuality'), compQualityLabel = $('#compQualityLabel');
      compQuality && compQuality.addEventListener('input', ()=> compQualityLabel.textContent = compQuality.value);

      $('#compressBtn').addEventListener('click', async ()=>{
        const f = fileFor('compressor');
        if(!f) return alert('Select an image (compressor).');
        const targetKb = parseInt($('#compTargetKb').value) || null;
        const targetPerc = parseInt($('#compTargetPerc').value) || null;
        const maxEdge = parseInt($('#compMaxEdge').value) || null;
        const startQuality = parseFloat(compQuality.value || 0.8);

        $('#compStatus').textContent = 'Compressing...';
        try{
          // If user specifically provided target KB, attempt iterative compression until target reached (with safety)
          if(targetKb){
            // iterative: reduce quality in steps until blob.size <= targetKb*1024 or quality < 0.2
            let q = startQuality;
            let lastGood = null;
            for(let i=0;i<8;i++){
              const opts = { initialQuality: q, useWebWorker:true, maxWidthOrHeight: maxEdge || undefined };
              const blob = await imageCompression(f, opts);
              const kb = Math.round(blob.size/1024);
              if(kb <= targetKb){ lastGood = blob; break; }
              // reduce quality
              q = q - 0.12;
              if(q < 0.2) break;
            }
            if(lastGood){
              saveAs(lastGood, changeName(f,'-compressed-'+targetKb+'KB.jpg'));
              $('#compStatus').textContent = 'Done';
            } else {
              // fallback: do one pass with requested quality
              const b = await imageCompression(f, { initialQuality:startQuality, useWebWorker:true, maxWidthOrHeight:maxEdge || undefined });
              saveAs(b, changeName(f,'-compressed.jpg'));
              $('#compStatus').textContent = 'Done (approx)';
            }
            return;
          }

          // If target percentage provided: compute desired size and attempt one pass at adjusted quality
          if(targetPerc){
            const desired = Math.max(10, Math.round((100-targetPerc)/100 * f.size)); // rough
            let q = Math.min(0.95, startQuality * ((desired / f.size) || 1));
            const b = await imageCompression(f, { initialQuality: q, useWebWorker:true, maxWidthOrHeight:maxEdge || undefined });
            saveAs(b, changeName(f,'-compressed-'+targetPerc+'pct.jpg'));
            $('#compStatus').textContent = 'Done';
            return;
          }

          // default: single pass with quality slider
          const blob = await imageCompression(f, { initialQuality:startQuality, useWebWorker:true, maxWidthOrHeight:maxEdge || undefined });
          saveAs(blob, changeName(f,'-compressed.jpg'));
          $('#compStatus').textContent = 'Done';
        }catch(err){
          console.error(err); alert('Compression failed: '+(err.message||err));
          $('#compStatus').textContent = 'Error';
        }
      });

      // Batch compress: iterate over perTool compressor if you have multiple, else globalFiles
      $('#compressBatchBtn').addEventListener('click', async ()=>{
        const files = Array.isArray(perTool['compressor']) ? perTool['compressor'] : (globalFiles.length ? globalFiles : (perTool['compressor'] ? [perTool['compressor']] : []));
        if(!files.length) return alert('No files for batch compress.');
        $('#compStatus').textContent = 'Batch running...';
        for(const f of files){
          try{
            const blob = await imageCompression(f, { initialQuality: parseFloat(compQuality.value||0.8), useWebWorker:true });
            saveAs(blob, changeName(f,'-compressed.jpg'));
          }catch(e){ console.error('batch err', e); }
        }
        $('#compStatus').textContent = 'Batch done';
      });

      // ---------- RESIZE & ROTATE ----------
      const rotRange = $('#rotRange'), rotLabel = $('#rotLabel');
      rotRange && rotRange.addEventListener('input', ()=> rotLabel.textContent = rotRange.value);

      $$('.rotatePreset').forEach(btn => btn.addEventListener('click', (e)=>{
        const deg = parseInt(e.currentTarget.dataset.rotate);
        rotRange.value = deg; rotLabel.textContent = deg;
      }));

      $('#applyResizeBtn').addEventListener('click', async ()=>{
        const f = fileFor('resize');
        if(!f) return alert('Select image for resize.');
        const w = parseInt($('#resizeW').value) || null;
        const h = parseInt($('#resizeH').value) || null;
        const keep = $('#keepAspect').checked;
        const rot = parseInt(rotRange.value) || 0;
        if(!w && !h && rot===0) return alert('Set width or height or rotate.');
        try{
          const dataUrl = await fileToDataURL(f);
          const img = await createImage(dataUrl);
          let newW = img.width, newH = img.height;
          if(w && h){ newW = w; newH = h; }
          else if(w){ newW = w; newH = keep ? Math.round(img.height*(w/img.width)) : img.height; }
          else if(h){ newH = h; newW = keep ? Math.round(img.width*(h/img.height)) : img.width; }

          // Rotate handling: compute canvas size for rotated image
          const rad = rot * Math.PI / 180;
          const sin = Math.abs(Math.sin(rad)), cos = Math.abs(Math.cos(rad));
          const cw = Math.round(newW * cos + newH * sin);
          const ch = Math.round(newW * sin + newH * cos);

          const canvas = document.createElement('canvas'); canvas.width = cw; canvas.height = ch;
          const ctx = canvas.getContext('2d');
          ctx.translate(cw/2, ch/2);
          ctx.rotate(rad);
          // Draw scaled image centered
          // create temp canvas for scaled image
          const tmp = document.createElement('canvas'); tmp.width = newW; tmp.height = newH;
          tmp.getContext('2d').drawImage(img, 0, 0, newW, newH);
          ctx.drawImage(tmp, -newW/2, -newH/2);

          canvas.toBlob(blob => saveAs(blob, changeName(f, `-resized-${newW}x${newH}-rot${rot}.jpg`)), 'image/jpeg', 0.92);
        }catch(e){ console.error(e); alert('Resize failed'); }
      });

      // ---------- IMAGE -> PDF ----------
      $('#imgToPdfBtn').addEventListener('click', async ()=>{
        const files = perTool['imgpdf'] ? (Array.isArray(perTool['imgpdf']) ? perTool['imgpdf'] : [perTool['imgpdf']]) : globalFiles;
        if(!files || files.length===0) return alert('Select images for PDF.');
        try{
          const { jsPDF } = window.jspdf;
          const orient = $('#pdfOrient').value || 'portrait';
          const pdf = new jsPDF({ unit:'pt', format:'a4', orientation:orient });
          for(let i=0;i<files.length;i++){
            const f = files[i];
            const dataUrl = await fileToDataURL(f);
            const img = await createImage(dataUrl);
            const pageW = pdf.internal.pageSize.getWidth(), pageH = pdf.internal.pageSize.getHeight();
            const ratio = Math.min(pageW/img.width, pageH/img.height);
            const imgW = img.width*ratio, imgH = img.height*ratio;
            pdf.addImage(dataUrl, f.type.includes('png') ? 'PNG' : 'JPEG', (pageW-imgW)/2, (pageH-imgH)/2, imgW, imgH);
            if(i < files.length-1) pdf.addPage();
          }
          pdf.save('images.pdf');
        }catch(e){ console.error(e); alert('PDF creation failed'); }
      });

      // ---------- JPG -> PNG & PNG -> JPG ----------
      $('#jpgToPngBtn').addEventListener('click', async ()=>{
        const f = fileFor('jpgpng');
        if(!f) return alert('Select image (JPG → PNG).');
        try{
          const dataUrl = await fileToDataURL(f);
          const img = await createImage(dataUrl);
          const canvas = document.createElement('canvas'); canvas.width = img.width; canvas.height = img.height;
          canvas.getContext('2d').drawImage(img,0,0);
          canvas.toBlob(blob => saveAs(blob, changeName(f, '.png')), 'image/png');
        }catch(e){ console.error(e); alert('Convert failed'); }
      });

      $('#pngToJpgBtn').addEventListener('click', async ()=>{
        const f = fileFor('jpgpng');
        if(!f) return alert('Select image (PNG → JPG).');
        try{
          const q = parseFloat($('#convQuality').value || 0.9);
          const dataUrl = await fileToDataURL(f);
          const img = await createImage(dataUrl);
          const canvas = document.createElement('canvas'); canvas.width = img.width; canvas.height = img.height;
          const ctx = canvas.getContext('2d'); ctx.fillStyle = '#fff'; ctx.fillRect(0,0,canvas.width,canvas.height);
          ctx.drawImage(img,0,0);
          canvas.toBlob(blob => saveAs(blob, changeName(f, '.jpg')), 'image/jpeg', q);
        }catch(e){ console.error(e); alert('Convert failed'); }
      });

      // Save helper (uses FileSaver if available)
      function saveAs(blob, filename){
        try{
          if(window.saveAs) { window.saveAs(blob, filename); return; }
          const a = document.createElement('a');
          a.href = URL.createObjectURL(blob);
          a.download = filename;
          document.body.appendChild(a); a.click(); a.remove();
          setTimeout(()=> URL.revokeObjectURL(a.href), 1500);
        }catch(e){ console.error('save failed', e); alert('Save failed'); }
      }

      // Keyboard shortcuts: Ctrl+O -> open global dialog; Ctrl+S -> hint
      document.addEventListener('keydown', (e)=>{
        if((e.ctrlKey || e.metaKey) && e.key.toLowerCase() === 'o'){ e.preventDefault(); globalFileInput.click(); }
        if((e.ctrlKey || e.metaKey) && e.key.toLowerCase() === 's'){ e.preventDefault(); alert('Use the tool-specific Export/Save button to save files.'); }
      });

      // Small init: set default empty previews
      ['compressor','resize','imgpdf','jpgpng'].forEach(t => renderToolPreview(t));
    })();
  </script>

<script>
(function(){
  const finalTitle = "All Image Tools — Free Online Image Compressor";
  let index = 0;

  function type() {
    if (index <= finalTitle.length) {
      document.title = finalTitle.substring(0, index);
      index++;
      setTimeout(type, 90); 
    }
  }

  // Mobile browsers don't allow immediate title update,
  // so start only after everything is loaded.
  window.addEventListener("load", function() {
    // Ensure title starts empty
    document.title = "";
    setTimeout(type, 300);  
  });
})();
</script>
</body>
</html>
